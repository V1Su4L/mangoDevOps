pipeline{
    agent any
    environment{
        CODE_REPO="https://github.com/V1Su4L/mangoapp"
        CODE_DIR="mangoapp"
        IMAGE_NAME="mango"
        IMAGE_TAG="V${BUILD_NUMBER}"
    }
    stages{
        stage("Clone The project"){
            steps{
                script{
                    sh "rm -fr ${CODE_DIR}"
                    sh "git clone ${CODE_REPO}"
                }
            }
        }

        stage("Build Docker Image"){
            steps{
                script{
                    dir("${CODE_DIRECTORY}"){
                        sh "docker build -t ${IMAGE_NAME}:${IMAGE_TAG} ."
                    }
                }
            }
        }

        stage("Push to ECR"){
            steps{
                script{
                    sh 'docker images'
                }
            }
        }
    }
}